#include "SR04.h"
#include <Servo.h>
#define TRIG_PIN 12
#define ECHO_PIN 11
SR04 sr04 = SR04(ECHO_PIN,TRIG_PIN);
long a;
Servo myservo;  // create servo object to control a servo
// twelve servo objects can be created on most boards
int pos = 0;    // variable to store the servo position
const int LeftMotorForward = 8;
const int LeftMotorBackward = 7;
const int RightMotorForward = 4;
const int RightMotorBackward = 5;
const int enA = 6;
const int enB = 3;
#define maximum_distance 200
boolean goesForward = false;
//int distance = 100;

void setup() {
  Serial.begin(9600);
  pinMode(RightMotorForward, OUTPUT);
  pinMode(LeftMotorForward, OUTPUT);
  pinMode(LeftMotorBackward, OUTPUT);
  pinMode(RightMotorBackward, OUTPUT);
  pinMode(enA, OUTPUT);
  pinMode(enB, OUTPUT);
}

void loop() {
  turnXDeg();
  delay(100);
  getDist();
}

void turnXDeg() {
  myservo.attach(9);
  myservo.write(0);
  delay(100);
  a = sr04.Distance();
  delay(100);
  myservo.write(180);
  delay(100);
  myservo.write(180);
  delay(100);
  //myservo.detach(9);
}

void getDist() {
    if(a <= 50) {
      stopRobot();
      delay(100);
      wheel90Deg();
      delay(100);
      turnXDeg();
    }
    else {
      delay(100);
      goForward();
      delay(100);
      turnXDeg();
    }
}

void stopRobot() {
  analogWrite(enA, 0);
  analogWrite(enB, 0);
  digitalWrite(RightMotorForward, LOW);
  digitalWrite(LeftMotorForward, LOW);
  digitalWrite(RightMotorBackward, LOW);
  digitalWrite(LeftMotorBackward, LOW);
  delay(100);
}

void wheel90Deg() {
  analogWrite(enA, 123);
  analogWrite(enB, 123);
  digitalWrite(LeftMotorForward, HIGH);
  digitalWrite(RightMotorBackward, HIGH);
  digitalWrite(LeftMotorBackward, LOW);
  digitalWrite(RightMotorForward, LOW);
  delay(100);
}

void goForward() {
  analogWrite(enA, 123);
  analogWrite(enB, 123);
  digitalWrite(LeftMotorForward, HIGH);
  digitalWrite(RightMotorForward, HIGH); 
  digitalWrite(LeftMotorBackward, LOW);
  digitalWrite(RightMotorBackward, LOW); 
  delay(100);
}
